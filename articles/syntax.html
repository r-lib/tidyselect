<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Technical description of tidyselect • tidyselect</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Technical description of tidyselect">
<meta property="og:description" content="tidyselect">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidyselect</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/syntax.html">Technical description of tidyselect</a>
    </li>
  </ul>
</li>
<li>
  <a href="../articles/tidyselect.html">Get started</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../news/index.html">Changelog</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/r-lib/tidyselect/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Technical description of tidyselect</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/tidyselect/blob/master/vignettes/syntax.Rmd"><code>vignettes/syntax.Rmd</code></a></small>
      <div class="hidden name"><code>syntax.Rmd</code></div>

    </div>

    
    
<p>This is a technical description of the tidyselect syntax.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyselect</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>)

<span class="co"># For better printing</span>
<span class="no">mtcars</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="no">mtcars</span>)
<span class="no">iris</span> <span class="kw">&lt;-</span> <span class="kw pkg">tibble</span><span class="kw ns">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span>(<span class="no">iris</span>)</pre></body></html></div>
<p>To illustrate the semantics of tidyselect, we’ll use variants of <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::rename()</a></code> that return the named vector of locations for the selected or renamed elements:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">select_loc</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">data</span>, <span class="no">...</span>) {
  <span class="fu"><a href="../reference/eval_select.html">eval_select</a></span>(<span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">expr</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">...</span>)), <span class="no">data</span>)
}

<span class="no">rename_loc</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">data</span>, <span class="no">...</span>) {
  <span class="fu"><a href="../reference/eval_select.html">eval_rename</a></span>(<span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">expr</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">...</span>)), <span class="no">data</span>)
}</pre></body></html></div>
<div id="sets-of-variables" class="section level2">
<h2 class="hasAnchor">
<a href="#sets-of-variables" class="anchor"></a>Sets of variables</h2>
<p>The tidyselect syntax is all about <strong>sets</strong> of variables, internally represented by integer vectors of <strong>locations</strong>. For example, <code><a href="https://rdrr.io/r/base/c.html">c(1L, 2L)</a></code> represents the set of the first and second variables, as does <code><a href="https://rdrr.io/r/base/c.html">c(1L, 2L, 1L)</a></code>.</p>
<p>If a vector of locations contains duplicates, they are normally treated as the same element, since they represent sets. An exception to this occurs with named elements whose names differ. If the names don’t match, they are treated as different elements in order to allow renaming a variable to multiple names (see section on Renaming variables).</p>
<p>The syntax of tidyselect is generally designed for set combination. For instance, <code><a href="https://rdrr.io/r/base/c.html">c(foo(), bar())</a></code> represents the union of the variables in <code>foo()</code> and those in <code><a href="https://rdrr.io/r/grDevices/plotmath.html">bar()</a></code>.</p>
<div id="bare-names" class="section level3">
<h3 class="hasAnchor">
<a href="#bare-names" class="anchor"></a>Bare names</h3>
<p>Within <em>data-expressions</em> (see Evaluation section), bare names represent their own locations, i.e. a set of size 1. The following expressions are equivalent:</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">mpg</span>:<span class="no">hp</span>, -<span class="no">cyl</span>, <span class="no">vs</span>)
<span class="co">#&gt;  mpg disp   hp   vs </span>
<span class="co">#&gt;    1    3    4    8</span>

<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fl">1</span>:<span class="fl">4</span>, -<span class="fl">2</span>, <span class="fl">8</span>)
<span class="co">#&gt;  mpg disp   hp   vs </span>
<span class="co">#&gt;    1    3    4    8</span></pre></body></html></div>
</div>
<div id="the-operator" class="section level3">
<h3 class="hasAnchor">
<a href="#the-operator" class="anchor"></a>The <code>:</code> operator</h3>
<p><code>:</code> can be used to select consecutive variables between two locations. It returns the corresponding sequence of locations.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fl">2</span>:<span class="fl">4</span>)
<span class="co">#&gt;  cyl disp   hp </span>
<span class="co">#&gt;    2    3    4</span></pre></body></html></div>
<p>Because bare names represent their own locations, it is easy to select a range of variables:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">cyl</span>:<span class="no">hp</span>)
<span class="co">#&gt;  cyl disp   hp </span>
<span class="co">#&gt;    2    3    4</span></pre></body></html></div>
</div>
<div id="boolean-operators" class="section level3">
<h3 class="hasAnchor">
<a href="#boolean-operators" class="anchor"></a>Boolean operators</h3>
<p>Boolean operators provide a more intuitive approach to set combination. Though sets are internally represented with vectors of locations, they could equally be represented with a full logical vector of inclusion indicators (taking the <code><a href="https://rdrr.io/r/base/which.html">which()</a></code> of this vector would then recover the locations). The boolean operators should be considered in terms of the logical representation of sets.</p>
<p>The <code><a href="https://rdrr.io/r/base/Logic.html">|</a></code> operator takes the <strong>union</strong> of two sets:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>) <span class="kw">|</span> <span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>))
<span class="co">#&gt; Sepal.Length  Sepal.Width  Petal.Width </span>
<span class="co">#&gt;            1            2            4</span></pre></body></html></div>
<p>The <code><a href="https://rdrr.io/r/base/Logic.html">&amp;</a></code> operator takes the <strong>intersection</strong> of two sets:</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>) <span class="kw">&amp;</span> <span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>))
<span class="co">#&gt; Sepal.Width </span>
<span class="co">#&gt;           2</span></pre></body></html></div>
<p>The <code>!</code> operator takes the <strong>complement</strong> of a set:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(!<span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>))
<span class="co">#&gt; Sepal.Length Petal.Length      Species </span>
<span class="co">#&gt;            1            3            5</span></pre></body></html></div>
<p>Taking the intersection with a complement produces a set <strong>difference</strong>:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>) <span class="kw">&amp;</span> !<span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>))
<span class="co">#&gt; Sepal.Length </span>
<span class="co">#&gt;            1</span></pre></body></html></div>
</div>
<div id="dots-c-and-unary--" class="section level3">
<h3 class="hasAnchor">
<a href="#dots-c-and-unary--" class="anchor"></a>Dots, <code>c()</code>, and unary <code>-</code>
</h3>
<p>tidyselect functions can take dots like <code><a href="https://dplyr.tidyverse.org/reference/select.html">dplyr::select()</a></code>, or a named argument like <code>tidyr::pivot_longer()</code>. In the latter case, the dots syntax is accessible via <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. In fact <code>...</code> syntax is implemented through <code><a href="https://rdrr.io/r/base/c.html">c(...)</a></code> and is thus completely equivalent.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">mpg</span>, <span class="no">disp</span>:<span class="no">hp</span>)
<span class="co">#&gt;  mpg disp   hp </span>
<span class="co">#&gt;    1    3    4</span>

<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">mpg</span>, <span class="no">disp</span>:<span class="no">hp</span>))
<span class="co">#&gt;  mpg disp   hp </span>
<span class="co">#&gt;    1    3    4</span></pre></body></html></div>
<p>Dots and <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> are syntax for:</p>
<ul>
<li>Set union or set difference</li>
<li>Renaming variables</li>
</ul>
<p>Non-negative inputs are recursively joined with <code><a href="https://rdrr.io/r/base/sets.html">union()</a></code>. The precedence is left-associative, just like with boolean operators. These expressions are all syntax for <em>set union</em>:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>), <span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>), <span class="no">Species</span>)
<span class="co">#&gt; Sepal.Length  Sepal.Width  Petal.Width      Species </span>
<span class="co">#&gt;            1            2            4            5</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>) <span class="kw">|</span> <span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>) <span class="kw">|</span> <span class="no">Species</span>)
<span class="co">#&gt; Sepal.Length  Sepal.Width  Petal.Width      Species </span>
<span class="co">#&gt;            1            2            4            5</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sets.html">union</a></span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>), <span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>)), <span class="fl">5L</span>))
<span class="co">#&gt; Sepal.Length  Sepal.Width  Petal.Width      Species </span>
<span class="co">#&gt;            1            2            4            5</span></pre></body></html></div>
<p>Unary <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> is normally syntax for <em>set difference</em>:</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>), -<span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>), -<span class="no">Sepal.Length</span>)
<span class="co">#&gt; named integer(0)</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>), <span class="fu"><a href="../reference/starts_with.html">ends_with</a></span>(<span class="st">"Width"</span>)), <span class="fl">1L</span>))
<span class="co">#&gt; named integer(0)</span></pre></body></html></div>
<p>If the first <code>...</code> or <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> input is negative, an implicit <code><a href="../reference/everything.html">everything()</a></code> is appended.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(-<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>))
<span class="co">#&gt; Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            3            4            5</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/everything.html">everything</a></span>(), -<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>))
<span class="co">#&gt; Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            3            4            5</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/sets.html">setdiff</a></span>(<span class="fu"><a href="../reference/everything.html">everything</a></span>(), <span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>)))
<span class="co">#&gt; Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            3            4            5</span></pre></body></html></div>
<p>In this case, unary <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> is syntax for <em>set complement</em>. Unary <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> and <code>!</code> are equivalent:</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(-<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>))
<span class="co">#&gt; Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            3            4            5</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(!<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>))
<span class="co">#&gt; Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            3            4            5</span></pre></body></html></div>
<p>Each level of <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> is independent. In particular, a nested <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> starting with <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> always stands for set complement:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>), -<span class="no">Sepal.Length</span>))
<span class="co">#&gt; Sepal.Width </span>
<span class="co">#&gt;           2</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="no">Sepal.Length</span>)))
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            1            2            3            4            5</span></pre></body></html></div>
<p>In boolean terms, these expressions are equivalent to:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>) <span class="kw">&amp;</span> !<span class="no">Sepal.Length</span>)
<span class="co">#&gt; Sepal.Width </span>
<span class="co">#&gt;           2</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/starts_with.html">starts_with</a></span>(<span class="st">"Sepal"</span>) <span class="kw">|</span> !<span class="no">Sepal.Length</span>)
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            1            2            3            4            5</span></pre></body></html></div>
<p>In general, when unary <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code> is used alone outside <code>...</code> or <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>, it stands for set complement.</p>
</div>
<div id="renaming-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#renaming-variables" class="anchor"></a>Renaming variables</h3>
<div id="name-combination-and-propagation" class="section level4">
<h4 class="hasAnchor">
<a href="#name-combination-and-propagation" class="anchor"></a>Name combination and propagation</h4>
<p>When named inputs are provided in <code>...</code> or <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>, the selection is renamed. If the inputs are already named, the outer and inner names are <strong>combined</strong> with a <code>...</code> separator:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">bar</span> <span class="kw">=</span> <span class="no">mpg</span>, <span class="kw">baz</span> <span class="kw">=</span> <span class="no">cyl</span>))
<span class="co">#&gt; foo...bar foo...baz </span>
<span class="co">#&gt;         1         2</span></pre></body></html></div>
<p>Otherwise the outer names is <strong>propagated</strong> to the selected elements according to the following rules:</p>
<ul>
<li>
<p>With data frames, a numeric suffix is appended because columns must be uniquely named.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">mpg</span>, <span class="no">cyl</span>))
<span class="co">#&gt; foo1 foo2 </span>
<span class="co">#&gt;    1    2</span></pre></body></html></div>
</li>
<li>
<p>With normal vectors, the name is simply assigned to all selected inputs.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">mtcars</span>) <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">mpg</span>, <span class="no">cyl</span>))
<span class="co">#&gt; foo foo </span>
<span class="co">#&gt;   1   2</span></pre></body></html></div>
</li>
</ul>
<p>Combination and propagation can be composed by using nested <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>:</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw">bar</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">mpg</span>, <span class="no">cyl</span>)))
<span class="co">#&gt; foo...bar1 foo...bar2 </span>
<span class="co">#&gt;          1          2</span></pre></body></html></div>
</div>
<div id="set-combination-with-named-variables" class="section level4">
<h4 class="hasAnchor">
<a href="#set-combination-with-named-variables" class="anchor"></a>Set combination with named variables</h4>
<p>Named elements have special rules to determine their identities in a set. Unnamed elements match any names:</p>
<ul>
<li>
<code>a | c(foo = a)</code> is equivalent to <code><a href="https://rdrr.io/r/base/c.html">c(foo = a)</a></code>.</li>
<li>
<code>a &amp; c(foo = a)</code> is equivalent to <code><a href="https://rdrr.io/r/base/c.html">c(foo = a)</a></code>.</li>
</ul>
<p>Named elements with different names are distinct:</p>
<ul>
<li>
<code>c(foo = a) &amp; c(bar = a)</code> is equivalent to <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>.</li>
<li>
<code>c(foo = a) | c(bar = a)</code> is equivalent to <code><a href="https://rdrr.io/r/base/c.html">c(foo = a, bar = a)</a></code>.</li>
</ul>
<p>Because unnamed elements match any named ones, it is possible to select multiple elements and rename one of them:</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(!<span class="no">Species</span>, <span class="kw">foo</span> <span class="kw">=</span> <span class="no">Sepal.Width</span>)
<span class="co">#&gt; Sepal.Length          foo Petal.Length  Petal.Width </span>
<span class="co">#&gt;            1            2            3            4</span></pre></body></html></div>
</div>
</div>
<div id="predicate-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#predicate-functions" class="anchor"></a>Predicate functions</h3>
<p>Predicate function objects can be supplied as input. They are applied to all elements of the data, and should return <code>TRUE</code> or <code>FALSE</code> to indicate inclusion. Predicates in data-expressions are effectively expanded to the set of variables that they represent:</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">is.numeric</span>)
<span class="co">#&gt; Warning: Predicate functions must be wrapped in `where()`.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Bad</span>
<span class="co">#&gt;   data %&gt;% select(is.numeric)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Good</span>
<span class="co">#&gt;   data %&gt;% select(where(is.numeric))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Please update your code.</span>
<span class="co">#&gt; This message is displayed once per session.</span>
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span>
<span class="co">#&gt;            1            2            3            4</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">is.factor</span>)
<span class="co">#&gt; Warning: Predicate functions must be wrapped in `where()`.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Bad</span>
<span class="co">#&gt;   data %&gt;% select(is.factor)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   # Good</span>
<span class="co">#&gt;   data %&gt;% select(where(is.factor))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Please update your code.</span>
<span class="co">#&gt; This message is displayed once per session.</span>
<span class="co">#&gt; Species </span>
<span class="co">#&gt;       5</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">is.numeric</span> <span class="kw">|</span> <span class="no">is.factor</span>)
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width      Species </span>
<span class="co">#&gt;            1            2            3            4            5</span>

<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">is.numeric</span> <span class="kw">&amp;</span> <span class="no">is.factor</span>)
<span class="co">#&gt; named integer(0)</span></pre></body></html></div>
<p>Predicate functions supplied as symbols are ambiguous with column names, however proper naming conventions should ensure distinct namespaces in practice. See the Evaluation section for more about this ambiguity.</p>
</div>
</div>
<div id="selection-helpers" class="section level2">
<h2 class="hasAnchor">
<a href="#selection-helpers" class="anchor"></a>Selection helpers</h2>
<p>We call <em>selection helpers</em> any function that inspects the currently active variables with <code><a href="../reference/peek_vars.html">peek_vars()</a></code> and returns a selection.</p>
<ul>
<li>
<code><a href="../reference/peek_vars.html">peek_vars()</a></code> returns a character vector of names.</li>
<li>The returned selection can be any output conforming to the types described in the Data types section.</li>
</ul>
<p>Examples of selection helpers are <code><a href="../reference/all_of.html">all_of()</a></code>, <code><a href="../reference/starts_with.html">contains()</a></code>, or <code><a href="../reference/everything.html">last_col()</a></code>. These selection helpers are evaluated as env-expressions (see Evaluation section).</p>
</div>
<div id="supported-data-types" class="section level2">
<h2 class="hasAnchor">
<a href="#supported-data-types" class="anchor"></a>Supported data types</h2>
<p>The following data types can be returned from selection helpers or forced via <code>!!</code> or <code><a href="https://rdrr.io/r/base/force.html">force()</a></code> (the latter works in tidyselect because it is treated as an env-expression, see Evaluation section):</p>
<ul>
<li>
<p>Vectors of locations:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">3</span>)))
<span class="co">#&gt; Sepal.Length Petal.Length </span>
<span class="co">#&gt;            1            3</span></pre></body></html></div>
</li>
<li>
<p>Vectors of names. These are matched and transformed to locations.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Sepal.Length"</span>, <span class="st">"Petal.Length"</span>)))
<span class="co">#&gt; Sepal.Length Petal.Length </span>
<span class="co">#&gt;            1            3</span></pre></body></html></div>
</li>
<li>
<p>Predicate functions. These are applied to all elements to determine inclusion.</p>
<div class="sourceCode" id="cb25"><html><body><pre class="r"><span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span>(<span class="no">is.numeric</span>))
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span>
<span class="co">#&gt;            1            2            3            4</span></pre></body></html></div>
</li>
</ul>
</div>
<div id="evaluation" class="section level2">
<h2 class="hasAnchor">
<a href="#evaluation" class="anchor"></a>Evaluation</h2>
<div id="data-expressions-and-env-expressions" class="section level3">
<h3 class="hasAnchor">
<a href="#data-expressions-and-env-expressions" class="anchor"></a>Data-expressions and env-expressions</h3>
<p>tidyselect is not a typical tidy evaluation UI. The main difference is that there is no data masking. In a typical tidy eval function, expressions are evaluated with data-vars first in scope, followed by env-vars:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="no">mask</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">data</span>, <span class="no">expr</span>) {
  <span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/eval_tidy.html">eval_tidy</a></span>(<span class="kw pkg">rlang</span><span class="kw ns">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/nse-defuse.html">enquo</a></span>(<span class="no">expr</span>), <span class="no">data</span>)
}

<span class="no">foo</span> <span class="kw">&lt;-</span> <span class="fl">10</span>
<span class="no">cyl</span> <span class="kw">&lt;-</span> <span class="fl">200</span>

<span class="co"># `cyl` represents the data frame column here:</span>
<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">mask</span>(<span class="no">cyl</span> * <span class="no">foo</span>)
<span class="co">#&gt;  [1] 60 60 40 60 80 60 80 40 40 60 60 80 80 80 80 80 80 40 40 40 40 80 80 80 80</span>
<span class="co">#&gt; [26] 40 40 40 80 60 80 40</span></pre></body></html></div>
<p>It is possible to bypass the data frame variables by forcing symbols to be looked up in the environment with <code>!!</code> or <code>.env</code>:</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">mask</span>(!!<span class="no">cyl</span> * <span class="no">foo</span>)
<span class="co">#&gt; [1] 2000</span>
<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">mask</span>(<span class="no">.env</span>$<span class="no">cyl</span> * <span class="no">foo</span>)
<span class="co">#&gt; [1] 2000</span></pre></body></html></div>
<p>With tidyselect, there is no such hierarchical data masking. Instead, expressions are evaluated either in the context of the data frame or in the user environment, without overlap. The scope of lookup depends on the kind of expression:</p>
<ol style="list-style-type: decimal">
<li>
<p><strong>data-expressions</strong> are evaluated in the data frame only. This includes bare symbols, the boolean operators, <code><a href="https://rdrr.io/r/base/Arithmetic.html">-</a></code>, <code>:</code>, and <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. You can’t refer to environment-variables in a data-expression:</p>
<div class="sourceCode" id="cb28"><html><body><pre class="r"><span class="no">cyl_pos</span> <span class="kw">&lt;-</span> <span class="fl">2</span>
<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">mpg</span> <span class="kw">|</span> <span class="no">cyl_pos</span>)
<span class="co">#&gt; Error: Can't subset columns that don't exist.</span>
<span class="co">#&gt; ✖ Column `cyl_pos` doesn't exist.</span></pre></body></html></div>
</li>
<li>
<p><strong>env-expressions</strong> are evaluated in the environment. This includes all calls other than those mentioned above, as well as symbols that are part of those calls. You can’t refer to data-variables in a data-expression:</p>
<div class="sourceCode" id="cb29"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/all_of.html">all_of</a></span>(<span class="no">mpg</span>))
<span class="co">#&gt; Error: object 'mpg' not found</span></pre></body></html></div>
</li>
</ol>
<p>Because the scoping is unambiguous, you can safely refer to env-vars in an env-expression, without having to worry about potential naming clashes with data-vars:</p>
<div class="sourceCode" id="cb30"><html><body><pre class="r"><span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">3</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fl">4</span>:<span class="fl">6</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="fl">7</span>:<span class="fl">9</span>)

<span class="co"># `ncol(x)` is an env-expression, so `x` represents the data frame in</span>
<span class="co"># the environment rather than the column in the data frame</span>
<span class="no">x</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fl">2</span>:<span class="fu"><a href="https://rdrr.io/r/base/nrow.html">ncol</a></span>(<span class="no">x</span>))
<span class="co">#&gt; y z </span>
<span class="co">#&gt; 2 3</span></pre></body></html></div>
<p>If you have variable names in a character vector, it is safe to refer to the env-var containing the names with <code><a href="../reference/all_of.html">all_of()</a></code> because it is an env-expression:</p>
<div class="sourceCode" id="cb31"><html><body><pre class="r"><span class="no">y</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"y"</span>, <span class="st">"z"</span>)
<span class="no">x</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/all_of.html">all_of</a></span>(<span class="no">y</span>))
<span class="co">#&gt; y z </span>
<span class="co">#&gt; 2 3</span></pre></body></html></div>
<p>Note that currently, env-vars are still allowed in some data-expressions, for compatibility. However this is in the process of being deprecated and you should see a note recommending to use <code><a href="../reference/all_of.html">all_of()</a></code> instead. This note will become a deprecation warning in the future, and then an error.</p>
<div class="sourceCode" id="cb32"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">cyl_pos</span>)
<span class="co">#&gt; Note: Using an external vector in selections is ambiguous.</span>
<span class="co">#&gt; ℹ Use `all_of(cyl_pos)` instead of `cyl_pos` to silence this message.</span>
<span class="co">#&gt; ℹ See &lt;https://tidyselect.r-lib.org/reference/faq-external-vector.html&gt;.</span>
<span class="co">#&gt; This message is displayed once per session.</span>
<span class="co">#&gt; cyl </span>
<span class="co">#&gt;   2</span></pre></body></html></div>
</div>
<div id="predicate-functions-within-data-expressions" class="section level3">
<h3 class="hasAnchor">
<a href="#predicate-functions-within-data-expressions" class="anchor"></a>Predicate functions within data-expressions</h3>
<p>There is one exception to the unambiguous lookup rules in data expressions. If a data-var is not found in the data frame, tidyselect attempts to find a predicate function in the environment. This introduces an ambiguity when a predicate function has the same name as a column. This is a conscious design decision:</p>
<ul>
<li>It makes it easier to use predicate functions interactively.</li>
<li>The names of predicate functions and data frame columns rarely overlap.</li>
</ul>
<p>If you need 100% unambiguity, use <code><a href="../reference/all_of.html">all_of()</a></code> to refer to data frame columns, and force predicate functions with <code>!!</code> or <code><a href="https://rdrr.io/r/base/force.html">force()</a></code>. <code><a href="../reference/all_of.html">all_of()</a></code> is a way to explicitly opt for data lookup because it fails if the data frame doesn’t contain the columns, even if a function of the same name is found in the environment:</p>
<div class="sourceCode" id="cb33"><html><body><pre class="r"><span class="no">Species</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">is.numeric</a></span>(<span class="no">x</span>)

<span class="co"># Since `Species` is defined as a function, you won't get an error</span>
<span class="co"># even though the data-var doesn't exist:</span>
<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">Species</span>)
<span class="co">#&gt; Error: Can't subset columns that don't exist.</span>
<span class="co">#&gt; ✖ Column `Species` doesn't exist.</span>

<span class="co"># Use `all_of()` to be explicit that you want a data-var, not an env-var:</span>
<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="../reference/all_of.html">all_of</a></span>(<span class="st">"Species"</span>))
<span class="co">#&gt; Error: Can't subset columns that don't exist.</span>
<span class="co">#&gt; ✖ Column `Species` doesn't exist.</span></pre></body></html></div>
<p>Similarly, you can be explicit about finding predicate functions in the environment by forcing the symbols:</p>
<div class="sourceCode" id="cb34"><html><body><pre class="r"><span class="co"># By default the data-var has precedence over the env-var:</span>
<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">Species</span>)
<span class="co">#&gt; Species </span>
<span class="co">#&gt;       5</span>

<span class="co"># Use the force operator `!!` to force the env-var `Species`:</span>
<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(!!<span class="no">Species</span>)
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span>
<span class="co">#&gt;            1            2            3            4</span>

<span class="co"># Use the env-expression `force()` to force the env-var `Species`:</span>
<span class="no">iris</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="fu"><a href="https://rdrr.io/r/base/force.html">force</a></span>(<span class="no">Species</span>))
<span class="co">#&gt; Sepal.Length  Sepal.Width Petal.Length  Petal.Width </span>
<span class="co">#&gt;            1            2            3            4</span></pre></body></html></div>
</div>
<div id="arithmetic-operators" class="section level3">
<h3 class="hasAnchor">
<a href="#arithmetic-operators" class="anchor"></a>Arithmetic operators</h3>
<p>Within data-expressions (see Evaluation section), <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>, <code><a href="https://rdrr.io/r/base/Arithmetic.html">*</a></code> and <code><a href="https://rdrr.io/r/base/Arithmetic.html">/</a></code> are overridden to cause an error. This is to prevent confusion stemming from normal data masking usage where variables can be transformed on the fly:</p>
<div class="sourceCode" id="cb35"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">cyl</span>^<span class="fl">2</span>)
<span class="co">#&gt; Error: Can't use arithmetic operator `^` in selection context.</span>

<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">mpg</span> * <span class="no">wt</span>)
<span class="co">#&gt; Error: Can't use arithmetic operator `*` in selection context.</span></pre></body></html></div>
</div>
</div>
<div id="selecting-versus-renaming" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-versus-renaming" class="anchor"></a>Selecting versus renaming</h2>
<p>The select and rename variants take the same types of inputs and have the same type of return value. They have a few important differences.</p>
<div id="all-renaming-inputs-must-be-named" class="section level3">
<h3 class="hasAnchor">
<a href="#all-renaming-inputs-must-be-named" class="anchor"></a>All renaming inputs must be named</h3>
<p>Unlike <code><a href="../reference/eval_select.html">eval_select()</a></code> which can select without renaming, <code><a href="../reference/eval_select.html">eval_rename()</a></code> expects a fully named selection. If one or several names are missing, an error is thrown.</p>
<div class="sourceCode" id="cb36"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">mpg</span>)
<span class="co">#&gt; mpg </span>
<span class="co">#&gt;   1</span>

<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">rename_loc</span>(<span class="no">mpg</span>)
<span class="co">#&gt; Error: All renaming inputs must be named.</span></pre></body></html></div>
</div>
<div id="renaming-to-an-existing-variable-name" class="section level3">
<h3 class="hasAnchor">
<a href="#renaming-to-an-existing-variable-name" class="anchor"></a>Renaming to an existing variable name</h3>
<p>If the input data is a data frame, tidyselect generally throws an error when duplicate column names are selected, in order to respect the invariant of unique column names.</p>
<div class="sourceCode" id="cb37"><html><body><pre class="r"><span class="co"># Lists can have duplicates</span>
<span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span>(<span class="no">mtcars</span>) <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="no">mpg</span>, <span class="kw">foo</span> <span class="kw">=</span> <span class="no">cyl</span>)
<span class="co">#&gt; foo foo </span>
<span class="co">#&gt;   1   2</span>

<span class="co"># Data frames cannot</span>
<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="no">mpg</span>, <span class="kw">foo</span> <span class="kw">=</span> <span class="no">cyl</span>)
<span class="co">#&gt; Error: Names must be unique.</span>
<span class="co">#&gt; ✖ These names are duplicated:</span>
<span class="co">#&gt;   * "foo" at locations 1 and 2.</span></pre></body></html></div>
<p>A selection can rename a variable to an existing name if the latter is not part of the selection:</p>
<div class="sourceCode" id="cb38"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">cyl</span>, <span class="kw">cyl</span> <span class="kw">=</span> <span class="no">mpg</span>)
<span class="co">#&gt; Error: Names must be unique.</span>
<span class="co">#&gt; ✖ These names are duplicated:</span>
<span class="co">#&gt;   * "cyl" at locations 1 and 2.</span>

<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">disp</span>, <span class="kw">cyl</span> <span class="kw">=</span> <span class="no">mpg</span>)
<span class="co">#&gt; disp  cyl </span>
<span class="co">#&gt;    3    1</span></pre></body></html></div>
<p>This is not possible when renaming.</p>
<div class="sourceCode" id="cb39"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">rename_loc</span>(<span class="no">cyl</span>, <span class="kw">cyl</span> <span class="kw">=</span> <span class="no">mpg</span>)
<span class="co">#&gt; Error: All renaming inputs must be named.</span>

<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">rename_loc</span>(<span class="no">disp</span>, <span class="kw">cyl</span> <span class="kw">=</span> <span class="no">mpg</span>)
<span class="co">#&gt; Error: All renaming inputs must be named.</span></pre></body></html></div>
<p>However, the name conflict can be solved by renaming the existing variable to another name:</p>
<div class="sourceCode" id="cb40"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="no">cyl</span>, <span class="kw">cyl</span> <span class="kw">=</span> <span class="no">mpg</span>)
<span class="co">#&gt; foo cyl </span>
<span class="co">#&gt;   2   1</span>

<span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu">rename_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="no">cyl</span>, <span class="kw">cyl</span> <span class="kw">=</span> <span class="no">mpg</span>)
<span class="co">#&gt; foo cyl </span>
<span class="co">#&gt;   2   1</span></pre></body></html></div>
</div>
</div>
<div id="duplicate-columns-in-data-frames" class="section level2">
<h2 class="hasAnchor">
<a href="#duplicate-columns-in-data-frames" class="anchor"></a>Duplicate columns in data frames</h2>
<p>Normally a data frame shouldn’t have duplicate names. However, the real world is messy and duplicates do happen in the wild. tidyselect tries to be as permissive as it can with these duplicates so that users can restore unique names with <code>select()</code> or <code>rename()</code>.</p>
<p>First let’s create a data frame with duplicate names:</p>
<div class="sourceCode" id="cb41"><html><body><pre class="r"><span class="no">dups</span> <span class="kw">&lt;-</span> <span class="kw pkg">vctrs</span><span class="kw ns">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/new_data_frame.html">new_data_frame</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">x</span> <span class="kw">=</span> <span class="fl">3</span>))</pre></body></html></div>
<p>If the duplicates are not part of the selection, they are simply ignored:</p>
<div class="sourceCode" id="cb42"><html><body><pre class="r"><span class="no">dups</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">y</span>)
<span class="co">#&gt; y </span>
<span class="co">#&gt; 2</span></pre></body></html></div>
<p>If the duplicates are selected, this is an error:</p>
<div class="sourceCode" id="cb43"><html><body><pre class="r"><span class="no">dups</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">x</span>)
<span class="co">#&gt; Error: Names must be unique.</span>
<span class="co">#&gt; ✖ These names are duplicated:</span>
<span class="co">#&gt;   * "x" at locations 1 and 2.</span></pre></body></html></div>
<p>The duplicate names can be repaired by renaming chosen locations:</p>
<div class="sourceCode" id="cb44"><html><body><pre class="r"><span class="no">dups</span> <span class="kw">%&gt;%</span> <span class="fu">select_loc</span>(<span class="no">x</span>, <span class="kw">foo</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="co">#&gt;   x foo </span>
<span class="co">#&gt;   1   3</span>

<span class="no">dups</span> <span class="kw">%&gt;%</span> <span class="fu">rename_loc</span>(<span class="kw">foo</span> <span class="kw">=</span> <span class="fl">3</span>)
<span class="co">#&gt; foo </span>
<span class="co">#&gt;   3</span></pre></body></html></div>
</div>
<div id="acknowledgements" class="section level2">
<h2 class="hasAnchor">
<a href="#acknowledgements" class="anchor"></a>Acknowledgements</h2>
<p>The tidyselect syntax was inspired by the <code><a href="https://rdrr.io/r/base/subset.html">base::subset()</a></code> function written by Peter Dalgaard. The <code>select</code> parameter of <code><a href="https://rdrr.io/r/base/subset.html">subset.data.frame()</a></code> is evaluated in a data mask where the column names are bound to their locations in the data frame. This allows <code>:</code> to create sequences of variable locations. The locations can be combined with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>. This selection interface set the tone for the development of the tidyselect syntax.</p>
<div class="sourceCode" id="cb45"><html><body><pre class="r"><span class="no">mtcars</span> <span class="kw">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span>(<span class="kw">select</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">cyl</span>, <span class="no">hp</span>:<span class="no">wt</span>))
<span class="co">#&gt; # A tibble: 32 x 4</span>
<span class="co">#&gt;     cyl    hp  drat    wt</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     6   110  3.9   2.62</span>
<span class="co">#&gt; 2     6   110  3.9   2.88</span>
<span class="co">#&gt; 3     4    93  3.85  2.32</span>
<span class="co">#&gt; 4     6   110  3.08  3.22</span>
<span class="co">#&gt; # … with 28 more rows</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lionel Henry, <a href="http://hadley.nz">Hadley Wickham</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
